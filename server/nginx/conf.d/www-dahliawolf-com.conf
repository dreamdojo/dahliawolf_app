server {
	rewrite_log on;
	error_log /var/log/nginx/www.dahliawolf.com_error.log  debug;
	access_log /var/log/nginx/www.dahliawolf.com_access.log  main;	

    listen       80;
    server_name  www.dahliawolf.com;
	root   /var/gitrepos/dahliawolf_app/public_html/;
	index index.php  index.html index.htm;
	proxy_intercept_errors on;
	proxy_buffering on;
	proxy_buffer_size 8k;
	proxy_buffers 2048 8k;
	proxy_ignore_client_abort on;



	fastcgi_ignore_client_abort  on;

	#parse error pages...
	error_page  404  /error_pages/404.html;


        #proxy api calls to api
        location /api/commerce/ {
                proxy_pass      http://commerce.offlinela.com/1-0/;
        }

        #proxy api calls to api
        location /api/1-0/ {
                    proxy_pass      http://api.dahliawolf.com/1-0/;
        }

	#proxy api calls to api
        location /api/ {
                proxy_pass      http://api.dahliawolf.com/api.php;
        }


        location /mobile/ {
                #re-write mobile urls
                if (-f $document_root/$uri.php){
                        rewrite ^(.*)$ $1.php last;
                }

                rewrite ^\/mobile\/([A-Za-z-_.0-9]+)$(?<!php|css|js|png|jpg) /mobile/dahliawolf.php?is_user=true last;
                rewrite ^\/mobile\/shop\/([0-9]+)$(?<!post|fee|php|css|js|png|jpg) /mobile/shop/product.php?id_product=$1? last;
                rewrite ^\/mobile\/post\/([0-9]+)$(?<!shop|feed|php|css|js|png|jpg) /mobile/dahliawolf.php?is_post=true last;

                try_files $uri $uri/ @extensionless-php;
        }

        location /shop/ {
                #re-write shop urls
                rewrite ^\/shop\/([0-9]+)$(?<![css|js|png|jpg]) /shop/product.php?id_product=$1? last;

                try_files $uri $uri/ @extensionless-php;
        }

        location /post/ {
                #re-write post urls
                rewrite ^\/post\/([0-9]+)$(?<![css|js|png|jpg]) /post-details.php?posting_id=$1? last;

                try_files $uri $uri/ @extensionless-php;
        }

        location /bank/ {
            rewrite ^\/bank\/([A-Za-z-_.0-9]+)$(?<![css|js|png|jpg]) /bank.php?feed=$1&$query_string last;
            try_files $uri $uri/ @extensionless-php;
        }


        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
        	expires  max;
        	access_log  off;
        	log_not_found  off;
    	}

        location / {
                try_files $uri $uri/ @extensionless-php;
        }

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
                root   /var/gitrepos/dahliawolf_app/public_html/error_pages;
        }

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        location ~ \.php$ {
                root           /var/gitrepos/dahliawolf_app/public_html/;
                #fastcgi_pass  127.0.0.1:9000;
                fastcgi_pass   unix:/var/run/php-fpm.sock;
                fastcgi_index  index.php;
                fastcgi_param  SCRIPT_FILENAME  /var/gitrepos/dahliawolf_app/public_html/$fastcgi_script_name;
                include        /etc/nginx/fastcgi_params;
        }

	# remove the .php extension	
        location @extensionless-php {
              	#.php file rewrite.. if a $1.php file exists, load it
            	if (-f $document_root/$uri.php){
                    rewrite ^(.*)$ $1.php last;
            	}
			
		#profile rewrites
                rewrite ^/(followers|following)$ /account/$1;

		#shop rewrites
                rewrite ^\/shop\/([A-Za-z-_.0-9]+)\/$ /shop/product.php?id_product=$1;
		
                ## if the url is dw.com/something/more, assume the something is a username and more is a php file
                rewrite ^/([A-Za-z-_.0-9]+)/([A-Za-z-_.]+)$ /account/$2.php?username=$1;

		#profile shops
                rewrite ^/([A-Za-z-_.0-9]+)/shop/([0-9]+)$ /shop/product.php?id_product=$2&username=$1;
                rewrite ^/([A-Za-z-_.0-9]+)/shop/$ /shop/index.php?username=$1;

                ## if the url is just dw.com/something, assume the something is a username
                rewrite ^/([A-Za-z-_.0-9]+)$ /profile.php?username=$1 last;

	}

}


server {
	rewrite_log on;
	error_log /var/log/nginx/dev.dahliawolf.com_error.log debug;
	access_log /var/log/nginx/dev.dahliawolf.com_access.log main;

        listen       80;

        server_name  dev.dahliawolf.com dev.zyonnetworks.com;
        root   /var/gitrepos/dev_dahliawolf_app;
	index index.php;	

	#load error pages first
	error_page  404  /error_pages/404.html;

	proxy_buffering on;
	proxy_buffer_size 8k;
	proxy_buffers 2048 8k;
	proxy_intercept_errors on;
	proxy_ignore_client_abort on;

        
	fastcgi_ignore_client_abort  on;

	#proxy api calls to api
        location /api/commerce/ {
                proxy_pass      http://dev.commerce.offlinela.com/1-0/;
        }

	#proxy api calls to api
        location /api/1-0/ {
                proxy_pass      http://dev.api.dahliawolf.com/1-0/;
        }

        #proxy api calls to api
        location /api/ {
                proxy_pass      http://dev.api.dahliawolf.com/api.php;
        }

	#
	location /mobile/ {
                #re-write mobile urls
		if (-f $document_root/$uri.php){
                        rewrite ^(.*)$ $1.php last;
                }
		
                rewrite ^\/mobile\/([A-Za-z-_.0-9]+)$(?<!php|css|js|png|jpg|jpeg) /mobile/dahliawolf.php?is_user=true  last;
		rewrite ^\/mobile\/shop\/([0-9]+)$(?<!post|fee|php|css|js|png|jpg) /mobile/shop/product.php?id_product=$1? last;
		rewrite ^\/mobile\/post\/([0-9]+)$(?<!shop|feed|php|css|js|png|jpg) /mobile/dahliawolf.php?is_post=true last;

		try_files $uri $uri/ @extensionless-php;
        }

        location /shop/ {
                #re-write shop urls
                rewrite ^\/shop\/([0-9]+)$(?<![css|js|png|jpg]) /shop/product.php?id_product=$1? last;

                try_files $uri $uri/ @extensionless-php;
        }

        location /post/ {
                #re-write post urls
                rewrite ^\/post\/([0-9]+)$(?<![css|js|png|jpg]) /post-details.php?posting_id=$1? last;

                try_files $uri $uri/ @extensionless-php;
        }



        location / {
                root   /var/gitrepos/dev_dahliawolf_app;
                index  index.php index.html index.htm;
                try_files $uri $uri/ @extensionless-php;
        }


        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
                root   /var/gitrepos/dev_dahliawolf_app/error_pages;
        }

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        location ~ \.php$ {
                root           /var/gitrepos/dev_dahliawolf_app;
                #fastcgi_pass  127.0.0.1:9000;
                fastcgi_pass   unix:/var/run/php-fpm.sock;
                fastcgi_index  index.php;
                fastcgi_param  SCRIPT_FILENAME /var/gitrepos/dev_dahliawolf_app$fastcgi_script_name;
                include        /etc/nginx/fastcgi_params;
        }

        #remove the .php extension

        location @extensionless-php {
                #.php file rewrite.. if a $1.php file exists, load it
                if (-f $document_root/$uri.php){
                        rewrite ^(.*)$ $1.php last;
                }

                ## if the url is just dw.com/something, assume the something is a username
                rewrite ^/([A-Za-z-_.0-9]+)$ /profile.php?username=$1 last;

		#profile rewrites
                rewrite ^\/shop\/([A-Za-z-_.0-9]+)\/$ /shop/product.php?id_product=$1;

                ## if the url is dw.com/something/more, assume the something is a username and more is a php file
                rewrite ^/([A-Za-z-_.0-9]+)/([A-Za-z-_.]+)$ /account/$2.php?username=$1;

		#profile shops
                rewrite ^/([A-Za-z-_.0-9]+)/shop/([0-9]+)$ /shop/product.php?id_product=$2&username=$1;
                rewrite ^/([A-Za-z-_.0-9]+)/shop/$ /shop/index.php?username=$1;

		if ($uri ~ (^\/$|\/index.php|index) ) {
               		set $memcached_key $server_name$request_uri; 
			#Catalog request modal
                 	memcached_pass memcached;
                  	add_header x-header-memcached true;
            	}
		

       }
}


server {
	rewrite_log on;
	error_log /var/log/nginx/teal.dahliawolf.com_error.log debug;
	access_log /var/log/nginx/teal.dahliawolf.com_access.log main;

    listen       80;

    server_name  teal.dahliawolf.com;
    root   /var/gitrepos/teal_dahliawolf_app/public_html;
    index index.php;

	#load error pages first
	error_page  404  /error_pages/404.html;

	proxy_buffering on;
	proxy_buffer_size 8k;
	proxy_buffers 2048 8k;
	proxy_intercept_errors on;
	proxy_ignore_client_abort on;


	fastcgi_ignore_client_abort  on;

	#proxy api calls to api
    location /api/commerce/ {
            proxy_pass      http://dev.commerce.offlinela.com/1-0/;
    }

	#proxy api calls to api
    location /api/1-0/ {
            proxy_pass      http://teal.api.dahliawolf.com/1-0/;
    }

    #proxy api calls to api
    location /api/ {
            proxy_pass      http://teal.api.dahliawolf.com/api.php;
    }

	#
	location /mobile/ {
                #re-write mobile urls
		if (-f $document_root/$uri.php){
                rewrite ^(.*)$ $1.php last;
        }

        rewrite ^\/mobile\/([A-Za-z-_.0-9]+)$(?<!php|css|js|png|jpg|jpeg) /mobile/dahliawolf.php?is_user=true&$query_string  last;
		rewrite ^\/mobile\/shop\/([0-9]+)$(?<!post|fee|php|css|js|png|jpg) /mobile/shop/product.php?id_product=$1&$query_string last;
		rewrite ^\/mobile\/post\/([0-9]+)$(?<!shop|feed|php|css|js|png|jpg) /mobile/dahliawolf.php?is_post=true&$query_string last;


		try_files $uri $uri/ @extensionless-php;
        }

        location /shop/ {
                #re-write shop urls
                rewrite ^\/shop\/([0-9]+)$(?<![css|js|png|jpg]) /shop/product.php?id_product=$1&$query_string last;

                try_files $uri $uri/ @extensionless-php;
        }

        location /sponsor/ {
                    #re-write shop urls
                    rewrite ^\/sponsor\/([0-9]+)$(?<![css|js|png|jpg]) /sponsor/product.php?id_product=$1&$query_string last;

                    try_files $uri $uri/ @extensionless-php;
            }

        location /post/ {
                #re-write post urls
                rewrite ^\/post\/([0-9]+)$(?<![css|js|png|jpg]) /post-details.php?posting_id=$1&$query_string last;

                try_files $uri $uri/ @extensionless-php;
        }


        location /bank/ {
            rewrite ^\/bank\/([A-Za-z-_.0-9]+)$(?<![css|js|png|jpg]) /bank.php?feed=$1&$query_string last;
            try_files $uri $uri/ @extensionless-php;
        }



        location / {
                root   /var/gitrepos/teal_dahliawolf_app/public_html;
                index  index.php index.html index.htm;
                try_files $uri $uri/ @extensionless-php;
        }


        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
                root   /var/gitrepos/teal_dahliawolf_app/public_html/error_pages;
        }

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        location ~ \.php$ {
                root           /var/gitrepos/teal_dahliawolf_app/public_html;
                #fastcgi_pass  127.0.0.1:9000;
                fastcgi_pass   unix:/var/run/php-fpm.sock;
                fastcgi_index  index.php;
                fastcgi_param  SCRIPT_FILENAME /var/gitrepos/teal_dahliawolf_app/public_html$fastcgi_script_name;
                include        /etc/nginx/fastcgi_params;
        }

        #remove the .php extension

        location @extensionless-php {
        #.php file rewrite.. if a $1.php file exists, load it
        if (-f $document_root/$uri.php){
                rewrite ^(.*)$ $1.php last;
        }

        ## if the url is just dw.com/something, assume the something is a username
        rewrite ^/([A-Za-z-_.0-9]+)$ /profile.php?username=$1&$query_string last;

		#profile rewrites
        rewrite ^\/shop\/([A-Za-z-_.0-9]+)\/$ /shop/product.php?id_product=$1&$query_string;

        ## if the url is dw.com/something/more, assume the something is a username and more is a php file
        rewrite ^/([A-Za-z-_.0-9]+)/([A-Za-z-_.]+)$ /account/$2.php?username=$1&$query_string;

		#profile shops
        rewrite ^/([A-Za-z-_.0-9]+)/shop/([0-9]+)$ /shop/product.php?id_product=$2&username=$1&$query_string;
        rewrite ^/([A-Za-z-_.0-9]+)/shop/$ /shop/index.php?username=$1&$query_string;

		if ($uri ~ (^\/$|\/index.php|index) ) {
            set $memcached_key $server_name$request_uri;
			#Catalog request modal
                memcached_pass memcached;
                add_header x-header-memcached true;
            }


       }
}


server {
        listen       80;
        server_name  blog.dahliawolf.com;

	    rewrite_log on;
        error_log /var/log/nginx/blog.dahliawolf.com_error.log  debug;
        access_log /var/log/nginx/blog.dahliawolf.com_access.log  main;
	
	    root /var/www/blog.dahliawolf.com/web_root;

        location / {
                index  index.php index.html index.htm;
                try_files $uri $uri/ @extensionless-php;
        }

        error_page  404              /404.html;
        location = /404.html {
		root /var/www/blog.dahliawolf.com/web_root/errors;
        }

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
		root /var/www/blog.dahliawolf.com/web_root/errors;
        }

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        location ~ \.php$ {
		root 		/var/www/blog.dahliawolf.com/web_root;
                #fastcgi_pass   127.0.0.1:9000;
                fastcgi_pass   unix:/var/run/php-fpm.sock;
                fastcgi_index  index.php;
                fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
                include        /etc/nginx/fastcgi_params;
        }
        # remove the .php extension
        location @extensionless-php {
                rewrite ^(.*)$ $1.php last;
        }
}


server {
        listen      80;
        server_name  nodewolf.dahliawolf.com;
        rewrite_log on;

        log_format upstreamlog '[$time_local] $remote_addr - $remote_user - $server_name  to: $upstream_addr: $request upstream_response_time $upstream_response_time msec $msec request_time $request_time';

        error_log /var/log/nginx/nodewolf.dahliawolf.com_error.log  debug;
        access_log /var/log/nginx/nodewolf.dahliawolf.com_access.log  upstreamlog;

        proxy_intercept_errors on;
        proxy_buffering on;
        proxy_buffer_size 8k;
        proxy_buffers 2048 8k;
        proxy_ignore_client_abort on;

        client_max_body_size 16M;

        location /livereload.js
        {
            ##hand over request
            proxy_read_timeout 1;
            proxy_pass      http://10.48.113.4:9001/;
        }


        #parse error pages...
        error_page  404  /error_pages/404.html;


        #proxy api calls to api
        location / {
            ##sockets support
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";


            proxy_next_upstream error timeout http_500 http_502 http_503 http_504;

            ##set some headers
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $http_host;
            proxy_set_header X-NginX-Proxy true;

            ##hand over request
            proxy_pass      http://10.48.113.4:9001/;
            proxy_redirect off;
        }


}
